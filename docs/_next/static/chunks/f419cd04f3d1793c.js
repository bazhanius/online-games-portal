(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55054,e=>{"use strict";e.i(47167);var t,i=e.i(43476),r=e.i(932),n=e.i(18566),o=e.i(71645);let s=["white","black"],a=["a","b","c","d","e","f","g","h"],l=["1","2","3","4","5","6","7","8"],h=[...l].reverse(),c=a.flatMap(e=>l.map(t=>e+t)),u=e=>e.every(e=>e>=0&&e<=7)?c[8*e[0]+e[1]]:void 0,d=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],f=c.map(d),p=c.map((e,t)=>({key:e,pos:f[t]}));function g(e){let t,i=()=>(void 0===t&&(t=e()),t);return i.clear=()=>{t=void 0},i}let m=e=>"white"===e?"black":"white",b=(e,t)=>(e[0]-t[0])**2+(e[1]-t[1])**2,v=(e,t)=>e.role===t.role&&e.color===t.color,_=e=>(t,i)=>[(i?t[0]:7-t[0])*e.width/8,(i?7-t[1]:t[1])*e.height/8],w=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},k=(e,t,i=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${i})`},y=(e,t)=>{e.style.visibility=t?"visible":"hidden"},C=e=>e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.targetTouches?.[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0,S=g(()=>!("ontouchstart"in window)&&["macintosh","firefox"].every(e=>navigator.userAgent.toLowerCase().includes(e))),x=e=>2===e.button&&!(e.ctrlKey&&S()),E=(e,t)=>{let i=document.createElement(e);return t&&(i.className=t),i};function M(e,t,i){let r=d(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[i.left+i.width*r[0]/8+i.width/16,i.top+i.height*(7-r[1])/8+i.height/16]}let A=(e,t)=>Math.abs(e-t),P=(e,t,i,r)=>A(e,i)*A(t,r)==2,T=(e,t,i,r)=>e===i!=(t===r),O=(e,t,i,r)=>A(e,i)===A(t,r)&&e!==i,R=e=>O(...e.orig.pos,...e.dest.pos),L=e=>T(...e.orig.pos,...e.dest.pos),I={pawn:e=>1>=A(e.orig.pos[0],e.dest.pos[0])&&(1===A(e.orig.pos[0],e.dest.pos[0])?e.dest.pos[1]===e.orig.pos[1]+("white"===e.color?1:-1):((e,t,i,r,n)=>{let o=n?1:-1;return e===i&&(r===t+o||r===t+2*o&&(n?t<=1:t>=6))})(...e.orig.pos,...e.dest.pos,"white"===e.color)),knight:e=>P(...e.orig.pos,...e.dest.pos),bishop:R,rook:L,queen:e=>R(e)||L(e),king:e=>((e,t,i,r)=>1===Math.max(A(e,i),A(t,r)))(...e.orig.pos,...e.dest.pos)||e.orig.pos[1]===e.dest.pos[1]&&e.orig.pos[1]===7*("white"!==e.color)&&(4===e.orig.pos[0]&&(2===e.dest.pos[0]&&e.rookFilesFriendlies.includes(0)||6===e.dest.pos[0]&&e.rookFilesFriendlies.includes(7))||e.rookFilesFriendlies.includes(e.dest.pos[0]))};function j(e,t){let i=e.pieces,r=i.get(t);if(!r||r.color===e.turnColor)return[];let n=r.color,o=new Map([...i].filter(([e,t])=>t.color===n)),s=new Map([...i].filter(([e,t])=>t.color===m(n))),a={orig:{key:t,pos:d(t)},role:r.role,allPieces:i,friendlies:o,enemies:s,color:n,rookFilesFriendlies:Array.from(i).filter(([e,t])=>e[1]===("white"===n?"1":"8")&&t.color===n&&"rook"===t.role).map(([e])=>d(e)[0]),lastMove:e.lastMove};return p.filter(t=>{let i;return i={...a,dest:t},I[r.role](i)&&e.premovable.additionalPremoveRequirements(i)}).map(e=>e.key)}function N(e,...t){e&&setTimeout(()=>e(...t),1)}function q(e){e.premovable.current&&(e.premovable.current=void 0,N(e.premovable.events.unset))}function K(e){let t=e.predroppable;t.current&&(t.current=void 0,N(t.events.unset))}function F(e,t,i){let r=e.pieces.get(t),n=e.pieces.get(i);if(t===i||!r)return!1;let o=n&&n.color!==r.color?n:void 0;return i===e.selected&&G(e),N(e.events.move,t,i,o),!function(e,t,i){if(!e.autoCastle)return!1;let r=e.pieces.get(t);if(!r||"king"!==r.role)return!1;let n=d(t),o=d(i);if(0!==n[1]&&7!==n[1]||n[1]!==o[1])return!1;4!==n[0]||e.pieces.has(i)||(6===o[0]?i=u([7,o[1]]):2===o[0]&&(i=u([0,o[1]])));let s=e.pieces.get(i);return!!s&&s.color===r.color&&"rook"===s.role&&((e.pieces.delete(t),e.pieces.delete(i),n[0]<o[0])?(e.pieces.set(u([6,o[1]]),r),e.pieces.set(u([5,o[1]]),s)):(e.pieces.set(u([2,o[1]]),r),e.pieces.set(u([3,o[1]]),s)),!0)}(e,t,i)&&(e.pieces.set(i,r),e.pieces.delete(t)),e.lastMove=[t,i],e.check=void 0,N(e.events.change),o||!0}function $(e,t,i,r){if(e.pieces.has(i))if(!r)return!1;else e.pieces.delete(i);return N(e.events.dropNewPiece,t,i),e.pieces.set(i,t),e.lastMove=[i],e.check=void 0,N(e.events.change),e.movable.dests=void 0,e.turnColor=m(e.turnColor),!0}function D(e,t,i){let r=F(e,t,i);return r&&(e.movable.dests=void 0,e.turnColor=m(e.turnColor),e.animation.current=void 0),r}function B(e,t,i){if(Q(e,t,i)){let r=D(e,t,i);if(r){let n=e.hold.stop();G(e);let o={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:n};return!0!==r&&(o.captured=r),N(e.movable.events.after,t,i,o),!0}}else if(Z(e,t,i)){var r;return r={ctrlKey:e.stats.ctrlKey},K(e),e.premovable.current=[t,i],N(e.premovable.events.set,t,i,r),G(e),!0}return G(e),!1}function W(e,t,i,r){var n,o,s,a,l,h,c;let u,d=e.pieces.get(t);if(d&&(n=e,o=t,s=i,(u=n.pieces.get(o))&&(o===s||!n.pieces.has(s))&&("both"===n.movable.color||n.movable.color===u.color&&n.turnColor===u.color)||r))e.pieces.delete(t),$(e,d,i,r),N(e.movable.events.afterNewPiece,d.role,i,{premove:!1,predrop:!1});else{let r,n;if(d&&(a=e,l=t,h=i,r=a.pieces.get(l),n=a.pieces.get(h),r&&(!n||n.color!==a.movable.color)&&a.predroppable.enabled&&("pawn"!==r.role||"1"!==h[1]&&"8"!==h[1])&&a.movable.color===r.color&&a.turnColor!==r.color)){c=d.role,q(e),e.predroppable.current={role:c,key:i},N(e.predroppable.events.set,c,i)}else q(e),K(e)}e.pieces.delete(t),G(e)}function U(e,t,i){if(N(e.events.select,t),e.selected)if(e.selected!==t||e.draggable.enabled){if((e.selectable.enabled||i)&&e.selected!==t&&B(e,e.selected,t)){e.stats.dragged=!1;return}}else{G(e),e.hold.cancel();return}(e.selectable.enabled||e.draggable.enabled)&&(H(e,t)||V(e,t))&&(z(e,t),e.hold.start())}function z(e,t){e.selected=t,V(e,t)?e.premovable.customDests||(e.premovable.dests=j(e,t)):e.premovable.dests=void 0}function G(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function H(e,t){let i=e.pieces.get(t);return!!i&&("both"===e.movable.color||e.movable.color===i.color&&e.turnColor===i.color)}let Q=(e,t,i)=>t!==i&&H(e,t)&&(e.movable.free||!!e.movable.dests?.get(t)?.includes(i));function V(e,t){let i=e.pieces.get(t);return!!i&&e.premovable.enabled&&e.movable.color===i.color&&e.turnColor!==i.color}let Z=(e,t,i)=>t!==i&&V(e,t)&&(e.premovable.customDests?.get(t)??j(e,t)).includes(i);function X(e){let t=e.premovable.current;if(!t)return!1;let i=t[0],r=t[1],n=!1;if(Q(e,i,r)){let t=D(e,i,r);if(t){let o={premove:!0};!0!==t&&(o.captured=t),N(e.movable.events.after,i,r,o),n=!0}}return q(e),n}function Y(e){q(e),K(e),G(e)}function J(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Y(e)}function ee(e,t,i){let r=Math.floor(8*(e[0]-i.left)/i.width);t||(r=7-r);let n=7-Math.floor(8*(e[1]-i.top)/i.height);return t||(n=7-n),r>=0&&r<8&&n>=0&&n<8?u([r,n]):void 0}let et="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",ei={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},er={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function en(e){"start"===e&&(e=et);let t=new Map,i=7,r=0;for(let n of e)switch(n){case" ":case"[":return t;case"/":if(--i<0)return t;r=0;break;case"~":{let e=u([r-1,i]),n=e&&t.get(e);n&&(n.promoted=!0);break}default:{let e=n.charCodeAt(0);if(e<57)r+=e-48;else{let e=n.toLowerCase(),o=u([r,i]);o&&t.set(o,{role:ei[e],color:n===e?"black":"white"}),++r}}}return t}function eo(e,t){t.animation&&(ea(e.animation,t.animation),70>(e.animation.duration||0)&&(e.animation.enabled=!1))}function es(e,t){if(t.movable?.dests&&(e.movable.dests=void 0),t.drawable?.autoShapes&&(e.drawable.autoShapes=[]),ea(e,t),t.fen&&(e.pieces=en(t.fen),e.drawable.shapes=t.drawable?.shapes||[]),"check"in t&&function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(let[i,r]of e.pieces)"king"===r.role&&r.color===t&&(e.check=i)}(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&z(e,e.selected),eo(e,t),!e.movable.rookCastle&&e.movable.dests){let t="white"===e.movable.color?"1":"8",i="e"+t,r=e.movable.dests.get(i),n=e.pieces.get(i);r&&n&&"king"===n.role&&e.movable.dests.set(i,r.filter(e=>!(e==="a"+t&&r.includes("c"+t))&&!(e==="h"+t&&r.includes("g"+t))))}}function ea(e,t){for(let i in t)"__proto__"!==i&&"constructor"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)&&el(e[i])&&el(t[i])?ea(e[i],t[i]):e[i]=t[i])}function el(e){if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}let eh=(e,t)=>t.animation.enabled?function(e,t){let i=new Map(t.pieces),r=e(t),n=function(e,t){let i,r,n,o=new Map,s=[],a=new Map,l=[],h=[],u=new Map;for(let[t,i]of e)u.set(t,eu(t,i));for(let e of c)i=t.pieces.get(e),r=u.get(e),i?r?v(i,r.piece)||(l.push(r),h.push(eu(e,i))):h.push(eu(e,i)):r&&l.push(r);for(let e of h)(r=ed(e,l.filter(t=>v(e.piece,t.piece))))&&(n=[r.pos[0]-e.pos[0],r.pos[1]-e.pos[1]],o.set(e.key,n.concat(n)),s.push(r.key));for(let e of l)s.includes(e.key)||a.set(e.key,e.piece);return{anims:o,fadings:a}}(i,t);if(n.anims.size||n.fadings.size){let e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:n},e||function e(t,i){let r=t.animation.current;if(void 0===r){t.dom.destroyed||t.dom.redrawNow();return}let n=1-(i-r.start)*r.frequency;if(n<=0)t.animation.current=void 0,t.dom.redrawNow();else{let i=ef(n);for(let e of r.plan.anims.values())e[2]=e[0]*i,e[3]=e[1]*i;t.dom.redrawNow(!0),requestAnimationFrame((i=performance.now())=>e(t,i))}}(t,performance.now())}else t.dom.redraw();return r}(e,t):ec(e,t);function ec(e,t){let i=e(t);return t.dom.redraw(),i}let eu=(e,t)=>({key:e,pos:d(e),piece:t}),ed=(e,t)=>t.sort((t,i)=>b(e.pos,t.pos)-b(e.pos,i.pos))[0],ef=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,ep=["green","red","blue","yellow"];function eg(e,t){e.drawable.current&&(e.drawable.current.pos=C(t))}function em(e){let t=e.drawable.current;t&&(t.mouseSq&&function(e,t){let i=e.shapes.find(e=>ev(e,t));i&&(e.shapes=e.shapes.filter(e=>!ev(e,t))),i&&i.brush===t.brush||e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),e_(e)}(e.drawable,t),eb(e))}function eb(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}let ev=(e,t)=>e.orig===t.orig&&e.dest===t.dest;function e_(e){e.onChange&&e.onChange(e.shapes)}function ew(e){requestAnimationFrame(()=>{let t=e.draggable.current;if(!t)return;e.animation.current?.plan.anims.has(t.orig)&&(e.animation.current=void 0);let i=e.pieces.get(t.orig);if(i&&v(i,t.piece)){if(!t.started&&b(t.pos,t.origPos)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if("function"==typeof t.element){let e=t.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),t.element=e}let i=e.dom.bounds();w(t.element,[t.pos[0]-i.left-i.width/16,t.pos[1]-i.top-i.height/16]),t.keyHasChanged||(t.keyHasChanged=t.orig!==ee(t.pos,"white"===e.orientation,i))}}else eC(e);ew(e)})}function ek(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=C(t))}function ey(e,t){let i=e.draggable.current;if(!i)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&i.originTarget!==t.target&&!i.newPiece){e.draggable.current=void 0;return}q(e),K(e);let r=ee(C(t)||i.pos,"white"===e.orientation,e.dom.bounds());r&&i.started&&i.orig!==r?i.newPiece?W(e,i.orig,r,i.force):(e.stats.ctrlKey=t.ctrlKey,B(e,i.orig,r)&&(e.stats.dragged=!0)):i.newPiece?e.pieces.delete(i.orig):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(i.orig),N(e.events.change)),(i.orig===i.previouslySelected||i.keyHasChanged)&&(i.orig===r||!r)?G(e):e.selectable.enabled||G(e),eS(e),e.draggable.current=void 0,e.dom.redraw()}function eC(e){let t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,G(e),eS(e),e.dom.redraw())}function eS(e){let t=e.dom.elements;t.ghost&&y(t.ghost,!1)}function ex(e,t){let i=e.dom.elements.board.firstChild;for(;i;){if(i.cgKey===t&&"PIECE"===i.tagName)return i;i=i.nextSibling}}function eE(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function eM({orig:e,dest:t,brush:i,piece:r,modifiers:n,customSvg:o,label:s,below:a},l,h,c,u,d){return[c.width,c.height,h,u&&"pendingErase",d,e,t,i,l&&"-",r&&eA(r),n&&eP(n),o&&`custom-${eT(o.html)},${o.center?.[0]??"o"}`,s&&`label-${eT(s.text)}`,a&&"below"].filter(e=>e).join(",")}let eA=e=>[e.color,e.role,e.scale].filter(e=>e).join(","),eP=e=>[e.lineWidth,e.hilite].filter(e=>e).join(",");function eT(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i)>>>0;return t.toString()}let eO=(e,t)=>"white"===t?e:[7-e[0],7-e[1]],eR=(e,t)=>(e%t+t)%t,eL=e=>[...e].some(t=>[-3,-2,-1,1,2,3].some(i=>e.has(eR(t+i,16)))),eI=(e,t)=>!!e&&t.has(e)&&eL(t.get(e)),ej=e=>document.createElementNS("http://www.w3.org/2000/svg",e),eN=(e,t)=>e&&t.has(e)?t.get(e).size:0;function eq(e,t){for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.setAttribute(i,t[i]);return e}let eK=(e,t)=>t?{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(e=>e).join("")}:e;function eF(e){let t=e.modifiers?.hilite;return{key:t&&`hilite-${t.replace("#","")}`,color:t}}let e$=(e,t,i)=>(e.opacity||1)*(i?.6:t?.9:1);function eD(e,t){let i=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*i,(3.5-e[1])*r]}let eB=e=>eR(Math.round(8*e/Math.PI),16),eW=(e,t)=>Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;function eU(e,t,i){let r=Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((e,t)=>e+t*t,0)),n=eW(e,t);if(i&&(r-=33/64,eL(i))){r-=10/64;let e=eB(n);1&e&&[-1,1].some(t=>i.has(eR(e+t,16)))&&(r-=.4)}return[e[0]-Math.cos(n)*r,e[1]-Math.sin(n)*r].map(e=>e+.5)}function ez(e,t){let i,r,n=eq(ej("svg"),{class:e,viewBox:t?"-4 -4 8 8":"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"});return t&&n.appendChild((i=ej("defs"),(r=eq(ej("filter"),{id:"cg-filter-blur"})).appendChild(eq(ej("feGaussianBlur"),{stdDeviation:"0.013"})),i.appendChild(r),i)),n.appendChild(ej("g")),n}function eG(e,t,i){let r,n=E("coords",t);return e.forEach((e,t)=>{(r=E("coord",`coord-${t%2==+("white"!==i)?"light":"dark"}`)).textContent=e,n.appendChild(r)}),n}function eH(e,t,i,r){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i,r)}let eQ=(e,t,i)=>r=>{e.drawable.current?e.drawable.enabled&&i(e,r):e.viewOnly||t(e,r)};function eV(e){let t=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,r=t.height/t.width,n=8*Math.floor(t.width*window.devicePixelRatio/8)/window.devicePixelRatio,o=n*r;i.style.width=n+"px",i.style.height=o+"px",e.dom.bounds.clear(),e.addDimensionsCssVarsTo?.style.setProperty("---cg-width",n+"px"),e.addDimensionsCssVarsTo?.style.setProperty("---cg-height",o+"px")}let eZ=e=>"PIECE"===e.tagName,eX=e=>"SQUARE"===e.tagName;function eY(e,t){let i=e[1];return`${t?10-i:3+i}`}let eJ=e=>`${e.color} ${e.role}`,e0=(e,t)=>e.lastMove?.[1]&&!e.pieces.has(e.lastMove[1])&&"e"===e.lastMove[0][0]&&["h","a"].includes(e.lastMove[1][0])&&e.lastMove[0][1]===e.lastMove[1][1]&&((e,t,i,r)=>{let n=i-e,o=r-t;if(n&&o&&Math.abs(n)!==Math.abs(o))return[];let s=Math.sign(n),a=Math.sign(o),l=[],h=e+s,c=t+a;for(;h!==i||c!==r;)l.push([h,c]),h+=s,c+=a;return l.map(u).filter(e=>void 0!==e)})(...d(e.lastMove[0]),...d(e.lastMove[1])).some(t=>e.pieces.has(t))?(t>e.lastMove[0]?"g":"c")+t[1]:t;function e1(e,t,i){let r=e.get(t);r?e.set(t,`${r} ${i}`):e.set(t,i)}function e2(e,t,i){let r=e.get(t);r?r.push(i):e.set(t,[i])}function e3(e,t,i,r){var n=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(n,e3.prototype),n.expected=t,n.found=i,n.location=r,n.name="SyntaxError",n}function e6(){this.constructor=e3}function e8(e,t,i){return(i=i||" ",e.length>t)?e:(t-=e.length,e+(i+=i.repeat(t)).slice(0,t))}function e5(e,t){return(e<<t|e>>64n-t)&0xffffffffffffffffn}function e4(e,t){return e*t&0xffffffffffffffffn}e6.prototype=Error.prototype,e3.prototype=new e6,e3.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var i,r=null;for(i=0;i<e.length;i++)if(e[i].source===this.location.source){r=e[i].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,o=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(n):n,s=this.location.source+":"+o.line+":"+o.column;if(r){var a=this.location.end,l=e8("",o.line.toString().length," "),h=r[n.line-1],c=(n.line===a.line?a.column:h.length+1)-n.column||1;t+="\n --> "+s+"\n"+l+" |\n"+o.line+" | "+h+"\n"+l+" | "+e8("",n.column-1," ")+e8("",c,"^")}else t+="\n at "+s}return t},e3.buildMessage=function(e,t){var i={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t=e.parts.map(function(e){return Array.isArray(e)?o(e[0])+"-"+o(e[1]):o(e)});return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function o(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function s(e){return i[e.type](e)}return"Expected "+function(e){var t,i,r=e.map(s);if(r.sort(),r.length>0){for(t=1,i=1;t<r.length;t++)r[t-1]!==r[t]&&(r[i]=r[t],i++);r.length=i}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(e)+" but "+(t?'"'+n(t)+'"':"end of input")+" found."};let e7=(t=0xa187eb39cdcaed8f31c4b365b102e01en,function(){let e=BigInt(0xffffffffffffffffn&t),i=BigInt(t>>64n&0xffffffffffffffffn),r=e4(e5(e4(e,5n),7n),9n);return i^=e,e=(e5(e,24n)^i^i<<16n)&0xffffffffffffffffn,t=(i=e5(i,37n))<<64n|e,r}),e9=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>e7()))),te=Array.from({length:8},()=>e7()),tt=Array.from({length:16},()=>e7()),ti=e7(),tr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class tn{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,t){const{color:i,piece:r,from:n,to:o,flags:s,captured:a,promotion:l}=t,h=tw(n),c=tw(o);for(const n in this.color=i,this.piece=r,this.from=h,this.to=c,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=h+c,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="",ts)ts[n]&s&&(this.flags+=to[n]);a&&(this.captured=a),l&&(this.promotion=l,this.lan+=l)}isCapture(){return this.flags.indexOf(to.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(to.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(to.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(to.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(to.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(to.BIG_PAWN)>-1}}let to={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},ts={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},ta={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},tl={...ta,WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},th={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},tc={b:[16,32,17,15],w:[-16,-32,-17,-15]},tu={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},td=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],tf=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],tp={p:1,n:2,b:4,r:8,q:16,k:32},tg=["n","b","r","q"],tm={k:ts.KSIDE_CASTLE,q:ts.QSIDE_CASTLE},tb={w:[{square:th.a1,flag:ts.QSIDE_CASTLE},{square:th.h1,flag:ts.KSIDE_CASTLE}],b:[{square:th.a8,flag:ts.QSIDE_CASTLE},{square:th.h8,flag:ts.KSIDE_CASTLE}]},tv={b:1,w:6};function t_(e){return -1!=="0123456789".indexOf(e)}function tw(e){let t=15&e,i=e>>4;return"abcdefgh".substring(t,t+1)+"87654321".substring(i,i+1)}function tk(e){return"w"===e?"b":"w"}function ty(e,t,i,r,n,o,s=ts.NORMAL){let a=r>>4;if("p"===n&&(7===a||0===a))for(let a=0;a<tg.length;a++){let l=tg[a];e.push({color:t,from:i,to:r,piece:n,captured:o,promotion:l,flags:s|ts.PROMOTION})}else e.push({color:t,from:i,to:r,piece:n,captured:o,flags:s})}function tC(e){let t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return"p"}return"o"===(t=t.toLowerCase())?"k":t}function tS(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class tx{_board=Array(128);_turn="w";_header={};_kings={w:-1,b:-1};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(e=tr,{skipValidation:t=!1}={}){this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=Array(128),this._kings={w:-1,b:-1},this._turn="w",this._castling={w:0,b:0},this._epSquare=-1,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...tl},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:i=!1}={}){let r=e.split(/\s+/);if(r.length>=2&&r.length<6&&(e=r.concat(["-","-","0","1"].slice(-(6-r.length))).join(" ")),r=e.split(/\s+/),!t){let{ok:t,error:i}=function(e){let t=e.split(/\s+/);if(6!==t.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};let i=parseInt(t[5],10);if(isNaN(i)||i<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};let r=parseInt(t[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};let n=t[0].split("/");if(8!==n.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let e=0;e<n.length;e++){let t=0,i=!1;for(let r=0;r<n[e].length;r++)if(t_(n[e][r])){if(i)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};t+=parseInt(n[e][r],10),i=!0}else{if(!/^[prnbqkPRNBQK]$/.test(n[e][r]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};t+=1,i=!1}if(8!==t)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};for(let{color:e,regex:i}of[{color:"white",regex:/K/g},{color:"black",regex:/k/g}]){if(!i.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${e} king`};if((t[0].match(i)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${e} kings`}}return Array.from(n[0]+n[7]).some(e=>"P"===e.toUpperCase())?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}(e);if(!t)throw Error(i)}let n=r[0],o=0;this.clear({preserveHeaders:i});for(let e=0;e<n.length;e++){let t=n.charAt(e);if("/"===t)o+=8;else if(t_(t))o+=parseInt(t,10);else{let e=t<"a"?"w":"b";this._put({type:t.toLowerCase(),color:e},tw(o)),o++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=ts.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=ts.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=ts.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=ts.QSIDE_CASTLE),this._epSquare="-"===r[3]?-1:th[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){let t=0,i="";for(let e=th.a8;e<=th.h1;e++){if(this._board[e]){t>0&&(i+=t,t=0);let{color:r,type:n}=this._board[e];i+="w"===r?n.toUpperCase():n.toLowerCase()}else t++;e+1&136&&(t>0&&(i+=t),e!==th.h1&&(i+="/"),t=0,e+=8)}let r="";this._castling.w&ts.KSIDE_CASTLE&&(r+="K"),this._castling.w&ts.QSIDE_CASTLE&&(r+="Q"),this._castling.b&ts.KSIDE_CASTLE&&(r+="k"),this._castling.b&ts.QSIDE_CASTLE&&(r+="q"),r=r||"-";let n="-";if(-1!==this._epSquare)if(e)n=tw(this._epSquare);else{let e=this._epSquare+("w"===this._turn?16:-16);for(let t of[e+1,e-1]){if(136&t)continue;let e=this._turn;if(this._board[t]?.color===e&&this._board[t]?.type==="p"){this._makeMove({color:e,from:t,to:this._epSquare,piece:"p",captured:"p",flags:ts.EP_CAPTURE});let i=!this._isKingAttacked(e);if(this._undoMove(),i){n=tw(this._epSquare);break}}}}return[i,this._turn,r,n,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;let{color:t,type:i}=this._board[e];return e9[({w:0,b:1})[t]][({p:0,n:1,b:2,r:3,q:4,k:5})[i]][e]}_epKey(){return -1===this._epSquare?0n:te[7&this._epSquare]}_castlingKey(){return tt[this._castling.w>>5|this._castling.b>>3]}_computeHash(){let e=0n;for(let t=th.a8;t<=th.h1;t++){if(136&t){t+=7;continue}this._board[t]&&(e^=this._pieceKey(t))}return e^=this._epKey(),e^=this._castlingKey(),"b"===this._turn&&(e^=ti),e}_updateSetup(e){this._history.length>0||(e!==tr?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(tr)}get(e){return this._board[th[e]]}findPiece(e){let t=[];for(let i=th.a8;i<=th.h1;i++){if(136&i){i+=7;continue}this._board[i]&&this._board[i]?.color===e.color&&this._board[i].color===e.color&&this._board[i].type===e.type&&t.push(tw(i))}return t}put({type:e,color:t},i){return!!this._put({type:e,color:t},i)&&(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}_set(e,t){this._hash^=this._pieceKey(e),this._board[e]=t,this._hash^=this._pieceKey(e)}_put({type:e,color:t},i){if(-1==="pnbrqkPNBRQK".indexOf(e.toLowerCase())||!(i in th))return!1;let r=th[i];if("k"==e&&-1!=this._kings[t]&&this._kings[t]!=r)return!1;let n=this._board[r];return n&&"k"===n.type&&(this._kings[n.color]=-1),this._set(r,{type:e,color:t}),"k"===e&&(this._kings[t]=r),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){let t=this.get(e);return this._clear(th[e]),t&&"k"===t.type&&(this._kings[t.color]=-1),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){this._hash^=this._castlingKey();let e=this._board[th.e1]?.type==="k"&&this._board[th.e1]?.color==="w",t=this._board[th.e8]?.type==="k"&&this._board[th.e8]?.color==="b";e&&this._board[th.a1]?.type==="r"&&this._board[th.a1]?.color==="w"||(this._castling.w&=-65),e&&this._board[th.h1]?.type==="r"&&this._board[th.h1]?.color==="w"||(this._castling.w&=-33),t&&this._board[th.a8]?.type==="r"&&this._board[th.a8]?.color==="b"||(this._castling.b&=-65),t&&this._board[th.h8]?.type==="r"&&this._board[th.h8]?.color==="b"||(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(-1===this._epSquare)return;let e=this._epSquare+("w"===this._turn?-16:16),t=this._epSquare+("w"===this._turn?16:-16);if(null!==this._board[e]||null!==this._board[this._epSquare]||this._board[t]?.color!==tk(this._turn)||this._board[t]?.type!=="p"){this._hash^=this._epKey(),this._epSquare=-1;return}[t+1,t-1].some(e=>!(136&e)&&this._board[e]?.color===this._turn&&this._board[e]?.type==="p")||(this._hash^=this._epKey(),this._epSquare=-1)}_attacked(e,t,i){let r=[];for(let n=th.a8;n<=th.h1;n++){if(136&n){n+=7;continue}if(void 0===this._board[n]||this._board[n].color!==e)continue;let o=this._board[n],s=n-t;if(0===s)continue;let a=s+119;if(td[a]&tp[o.type]){if("p"===o.type){if(s>0&&"w"===o.color||s<=0&&"b"===o.color)if(!i)return!0;else r.push(tw(n));continue}if("n"===o.type||"k"===o.type)if(!i)return!0;else{r.push(tw(n));continue}let e=tf[a],l=n+e,h=!1;for(;l!==t;){if(null!=this._board[l]){h=!0;break}l+=e}if(!h)if(!i)return!0;else{r.push(tw(n));continue}}}return!!i&&r}attackers(e,t){return t?this._attacked(t,th[e],!0):this._attacked(this._turn,th[e],!0)}_isKingAttacked(e){let t=this._kings[e];return -1!==t&&this._attacked(tk(e),t)}hash(){return this._hash.toString(16)}isAttacked(e,t){return this._attacked(t,th[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&0===this._moves().length}isStalemate(){return!this.isCheck()&&0===this._moves().length}isInsufficientMaterial(){let e={b:0,n:0,r:0,q:0,k:0,p:0},t=[],i=0,r=0;for(let n=th.a8;n<=th.h1;n++){if(r=(r+1)%2,136&n){n+=7;continue}let o=this._board[n];o&&(e[o.type]=o.type in e?e[o.type]+1:1,"b"===o.type&&t.push(r),i++)}if(2===i||3===i&&(1===e.b||1===e.n))return!0;if(i===e.b+2){let e=0,i=t.length;for(let r=0;r<i;r++)e+=t[r];if(0===e||e===i)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:t,piece:i}={}){let r=this._moves({square:t,piece:i});return e?r.map(e=>new tn(this,e)):r.map(e=>this._moveToSan(e,r))}_moves({legal:e=!0,piece:t,square:i}={}){let r=i?i.toLowerCase():void 0,n=t?.toLowerCase(),o=[],s=this._turn,a=tk(s),l=th.a8,h=th.h1,c=!1;if(r)if(!(r in th))return[];else l=h=th[r],c=!0;for(let e=l;e<=h;e++){let t;if(136&e){e+=7;continue}if(!this._board[e]||this._board[e].color===a)continue;let{type:i}=this._board[e];if("p"===i){if(n&&n!==i)continue;t=e+tc[s][0],!this._board[t]&&(ty(o,s,e,t,"p"),t=e+tc[s][1],tv[s]!==e>>4||this._board[t]||ty(o,s,e,t,"p",void 0,ts.BIG_PAWN));for(let i=2;i<4;i++)136&(t=e+tc[s][i])||(this._board[t]?.color===a?ty(o,s,e,t,"p",this._board[t].type,ts.CAPTURE):t===this._epSquare&&ty(o,s,e,t,"p","p",ts.EP_CAPTURE))}else{if(n&&n!==i)continue;for(let r=0,n=tu[i].length;r<n;r++){let n=tu[i][r];for(t=e;!(136&(t+=n));){if(this._board[t]){if(this._board[t].color===s)break;ty(o,s,e,t,i,this._board[t].type,ts.CAPTURE);break}if(ty(o,s,e,t,i),"n"===i||"k"===i)break}}}}if((void 0===n||"k"===n)&&(!c||h===this._kings[s])){if(this._castling[s]&ts.KSIDE_CASTLE){let e=this._kings[s],t=e+2;this._board[e+1]||this._board[t]||this._attacked(a,this._kings[s])||this._attacked(a,e+1)||this._attacked(a,t)||ty(o,s,this._kings[s],t,"k",void 0,ts.KSIDE_CASTLE)}if(this._castling[s]&ts.QSIDE_CASTLE){let e=this._kings[s],t=e-2;this._board[e-1]||this._board[e-2]||this._board[e-3]||this._attacked(a,this._kings[s])||this._attacked(a,e-1)||this._attacked(a,t)||ty(o,s,this._kings[s],t,"k",void 0,ts.QSIDE_CASTLE)}}if(!e||-1===this._kings[s])return o;let u=[];for(let e=0,t=o.length;e<t;e++)this._makeMove(o[e]),this._isKingAttacked(s)||u.push(o[e]),this._undoMove();return u}move(e,{strict:t=!1}={}){let i=null;if("string"==typeof e)i=this._moveFromSan(e,t);else if(null===e)i=this._moveFromSan("--",t);else if("object"==typeof e){let t=this._moves();for(let r=0,n=t.length;r<n;r++)if(e.from===tw(t[r].from)&&e.to===tw(t[r].to)&&(!("promotion"in t[r])||e.promotion===t[r].promotion)){i=t[r];break}}if(!i)if("string"==typeof e)throw Error(`Invalid move: ${e}`);else throw Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&i.flags&ts.NULL_MOVE)throw Error("Null move not allowed when in check");let r=new tn(this,i);return this._makeMove(i),this._incPositionCount(),r}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,t){this._hash^=this._pieceKey(e),this._board[t]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(t)}_makeMove(e){let t=this._turn,i=tk(t);if(this._push(e),e.flags&ts.NULL_MOVE){"b"===t&&this._moveNumber++,this._halfMoves++,this._turn=i,this._epSquare=-1;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&ts.EP_CAPTURE&&("b"===this._turn?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:t})),"k"===this._board[e.to].type){if(this._kings[t]=e.to,e.flags&ts.KSIDE_CASTLE){let t=e.to-1,i=e.to+1;this._movePiece(i,t)}else if(e.flags&ts.QSIDE_CASTLE){let t=e.to+1,i=e.to-2;this._movePiece(i,t)}this._castling[t]=0}if(this._castling[t]){for(let i=0,r=tb[t].length;i<r;i++)if(e.from===tb[t][i].square&&this._castling[t]&tb[t][i].flag){this._castling[t]^=tb[t][i].flag;break}}if(this._castling[i]){for(let t=0,r=tb[i].length;t<r;t++)if(e.to===tb[i][t].square&&this._castling[i]&tb[i][t].flag){this._castling[i]^=tb[i][t].flag;break}}if(this._hash^=this._castlingKey(),e.flags&ts.BIG_PAWN){let r;r="b"===t?e.to-16:e.to+16,(e.to-1&136||this._board[e.to-1]?.type!=="p"||this._board[e.to-1]?.color!==i)&&(e.to+1&136||this._board[e.to+1]?.type!=="p"||this._board[e.to+1]?.color!==i)?this._epSquare=-1:(this._epSquare=r,this._hash^=this._epKey())}else this._epSquare=-1;"p"===e.piece||e.flags&(ts.CAPTURE|ts.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,"b"===t&&this._moveNumber++,this._turn=i,this._hash^=ti}undo(){let e=this._hash,t=this._undoMove();if(t){let i=new tn(this,t);return this._decPositionCount(e),i}return null}_undoMove(){let e=this._history.pop();if(void 0===e)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();let t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=ti;let i=this._turn,r=tk(i);if(t.flags&ts.NULL_MOVE)return t;if(this._movePiece(t.to,t.from),t.piece&&(this._clear(t.from),this._set(t.from,{type:t.piece,color:i})),t.captured)if(t.flags&ts.EP_CAPTURE){let e;e="b"===i?t.to-16:t.to+16,this._set(e,{type:"p",color:r})}else this._set(t.to,{type:t.captured,color:r});if(t.flags&(ts.KSIDE_CASTLE|ts.QSIDE_CASTLE)){let e,i;t.flags&ts.KSIDE_CASTLE?(e=t.to+1,i=t.to-1):(e=t.to-2,i=t.to+1),this._movePiece(i,e)}return t}pgn({newline:e="\n",maxWidth:t=0}={}){let i=[],r=!1;for(let t in this._header)this._header[t]&&i.push(`[${t} "${this._header[t]}"]`+e),r=!0;r&&this._history.length&&i.push(e);let n=e=>{let t=this._comments[this.fen()];if(void 0!==t){let i=e.length>0?" ":"";e=`${e}${i}{${t}}`}return e},o=[];for(;this._history.length>0;)o.push(this._undoMove());let s=[],a="";for(0===o.length&&s.push(n(""));o.length>0;){a=n(a);let e=o.pop();if(!e)break;if(this._history.length||"b"!==e.color)"w"===e.color&&(a.length&&s.push(a),a=this._moveNumber+".");else{let e=`${this._moveNumber}. ...`;a=a?`${a} ${e}`:e}a=a+" "+this._moveToSan(e,this._moves({legal:!0})),this._makeMove(e)}if(a.length&&s.push(n(a)),s.push(this._header.Result||"*"),0===t)return i.join("")+s.join(" ");let l=function(){return i.length>0&&" "===i[i.length-1]&&(i.pop(),!0)},h=0;for(let r=0;r<s.length;r++){if(h+s[r].length>t&&s[r].includes("{")){h=function(r,n){for(let o of n.split(" "))if(o){if(r+o.length>t){for(;l();)r--;i.push(e),r=0}i.push(o),r+=o.length,i.push(" "),r++}return l()&&r--,r}(h,s[r]);continue}h+s[r].length>t&&0!==r?(" "===i[i.length-1]&&i.pop(),i.push(e),h=0):0!==r&&(i.push(" "),h++),i.push(s[r]),h+=s[r].length}return i.join("")}header(...e){for(let t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??ta[e]??null,this.getHeaders()}removeHeader(e){return e in this._header&&(this._header[e]=ta[e]||null,!0)}getHeaders(){let e={};for(let[t,i]of Object.entries(this._header))null!==i&&(e[t]=i);return e}loadPgn(e,{strict:t=!1,newlineChar:i="\r?\n"}={}){"\r?\n"!==i&&(e=e.replace(RegExp(i,"g"),"\n"));let r=function(e,t){var i,r,n,o,s={},a=(t=void 0!==t?t:{}).grammarSource,l={pgn:eC},h=eC,c="O-O-O",u="0-0-0",d="1/2-1/2",f=/^[a-zA-Z]/,p=/^[^"]/,g=/^[0-9]/,m=/^[.]/,b=/^[a-zA-Z1-8\-=]/,v=/^[+#]/,_=/^[!?]/,w=/^[^}]/,k=/^[^\r\n]/,y=/^[ \t\r\n]/,C=e_("tag pair"),S=eb("[",!1),x=eb('"',!1),E=eb("]",!1),M=e_("tag name"),A=ev([["a","z"],["A","Z"]],!1,!1),P=e_("tag value"),T=ev(['"'],!0,!1),O=e_("move number"),R=ev([["0","9"]],!1,!1),L=eb(".",!1),I=ev(["."],!1,!1),j=e_("standard algebraic notation"),N=eb("O-O-O",!1),q=eb("O-O",!1),K=eb("0-0-0",!1),F=eb("0-0",!1),$=ev([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),D=ev(["+","#"],!1,!1),B=e_("suffix annotation"),W=ev(["!","?"],!1,!1),U=e_("NAG"),z=eb("$",!1),G=e_("brace comment"),H=eb("{",!1),Q=ev(["}"],!0,!1),V=eb("}",!1),Z=e_("rest of line comment"),X=eb(";",!1),Y=ev(["\r","\n"],!0,!1),J=e_("variation"),ee=eb("(",!1),et=eb(")",!1),ei=e_("game termination marker"),er=eb("1-0",!1),en=eb("0-1",!1),eo=eb("1/2-1/2",!1),es=eb("*",!1),ea=e_("whitespace"),el=ev([" ","	","\r","\n"],!1,!1),eh=function(e,t){if(t.marker&&t.marker.comment){let e=t.root;for(;;){let i=e.variations[0];if(!i){e.comment=t.marker.comment;break}e=i}}return{headers:e,root:t.root,result:(t.marker&&t.marker.result)??void 0}},ec=function(e,t){return function(...e){let[t,...i]=e,r=t;for(let e of i)null!==e&&(r.variations=[e,...e.variations],e.variations=[],r=e);return t}(null!==e?{comment:e,variations:[]}:{variations:[]},...t.flat())},eu=function(e,t,i,r,n){let o;return o={move:e,variations:n},t&&(o.suffix=t),i&&(o.nag=i),null!==r&&(o.comment=r),o},ed=0|t.peg$currPos,ef=[{line:1,column:1}],ep=ed,eg=t.peg$maxFailExpected||[],em=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in l))throw Error("Can't start parsing from rule \""+t.startRule+'".');h=l[t.startRule]}function eb(e,t){return{type:"literal",text:e,ignoreCase:t}}function ev(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function e_(e){return{type:"other",description:e}}function ew(t){var i,r=ef[t];if(r)return r;if(t>=ef.length)i=ef.length-1;else for(i=t;!ef[--i];);for(r={line:(r=ef[i]).line,column:r.column};i<t;)10===e.charCodeAt(i)?(r.line++,r.column=1):r.column++,i++;return ef[t]=r,r}function ek(e,t,i){var r=ew(e),n=ew(t);return{source:a,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function ey(e){ed<ep||(ed>ep&&(ep=ed,eg=[]),eg.push(e))}function eC(){var t;return t=function(){var e,t;for(e=[],t=eS();t!==s;)e.push(t),t=eS();return t=eT(),Object.fromEntries(e)}(),eh(t,function(){var t,i,r,n,o;return t=ex(),eT(),(em++,r=ed,"1-0"===e.substr(ed,3)?(n="1-0",ed+=3):(n=s,0===em&&ey(er)),n===s&&("0-1"===e.substr(ed,3)?(n="0-1",ed+=3):(n=s,0===em&&ey(en)),n===s&&(e.substr(ed,7)===d?(n=d,ed+=7):(n=s,0===em&&ey(eo)),n===s&&(42===e.charCodeAt(ed)?(n="*",ed++):(n=s,0===em&&ey(es))))),n!==s)?(eT(),(o=eA())===s&&(o=null),r={result:n,comment:o}):(ed=r,r=s),em--,r===s&&(n=s,0===em&&ey(ei)),(i=r)===s&&(i=null),eT(),{root:t,marker:i}}())}function eS(){var t,i,r,n,o,a,l;return(em++,t=ed,eT(),91===e.charCodeAt(ed)?(i="[",ed++):(i=s,0===em&&ey(S)),i!==s&&(eT(),(r=function(){var t,i,r;if(em++,t=ed,i=[],r=e.charAt(ed),f.test(r)?ed++:(r=s,0===em&&ey(A)),r!==s)for(;r!==s;)i.push(r),r=e.charAt(ed),f.test(r)?ed++:(r=s,0===em&&ey(A));else i=s;return t=i!==s?e.substring(t,ed):i,em--,t===s&&(i=s,0===em&&ey(M)),t}())!==s&&(eT(),34===e.charCodeAt(ed)?(n='"',ed++):(n=s,0===em&&ey(x)),n!==s&&(o=function(){var t,i,r;for(em++,t=ed,i=[],r=e.charAt(ed),p.test(r)?ed++:(r=s,0===em&&ey(T));r!==s;)i.push(r),r=e.charAt(ed),p.test(r)?ed++:(r=s,0===em&&ey(T));return t=e.substring(t,ed),em--,i=s,0===em&&ey(P),t}(),34===e.charCodeAt(ed)?(a='"',ed++):(a=s,0===em&&ey(x)),a!==s&&(eT(),93===e.charCodeAt(ed)?(l="]",ed++):(l=s,0===em&&ey(E)),l!==s)))))?t=[r,o]:(ed=t,t=s),em--,t===s&&0===em&&ey(C),t}function ex(){var e,t,i;for((e=eA())===s&&(e=null),t=[],i=eE();i!==s;)t.push(i),i=eE();return ec(e,t)}function eE(){var t,i,r,n,o,a,l,h;if(t=ed,eT(),function(){var t,i,r,n,o,a;for(em++,t=ed,i=[],r=e.charAt(ed),g.test(r)?ed++:(r=s,0===em&&ey(R));r!==s;)i.push(r),r=e.charAt(ed),g.test(r)?ed++:(r=s,0===em&&ey(R));if(46===e.charCodeAt(ed)?(r=".",ed++):(r=s,0===em&&ey(L)),r!==s){for(n=eT(),o=[],a=e.charAt(ed),m.test(a)?ed++:(a=s,0===em&&ey(I));a!==s;)o.push(a),a=e.charAt(ed),m.test(a)?ed++:(a=s,0===em&&ey(I));t=i=[i,r,n,o]}else ed=t,t=s;em--,t===s&&(i=s,0===em&&ey(O))}(),eT(),(i=function(){var t,i,r,n,o,a;if(em++,t=ed,i=ed,e.substr(ed,5)===c?(r=c,ed+=5):(r=s,0===em&&ey(N)),r===s&&("O-O"===e.substr(ed,3)?(r="O-O",ed+=3):(r=s,0===em&&ey(q)),r===s&&(e.substr(ed,5)===u?(r=u,ed+=5):(r=s,0===em&&ey(K)),r===s))&&("0-0"===e.substr(ed,3)?(r="0-0",ed+=3):(r=s,0===em&&ey(F)),r===s))if(r=ed,n=e.charAt(ed),f.test(n)?ed++:(n=s,0===em&&ey(A)),n!==s){if(o=[],a=e.charAt(ed),b.test(a)?ed++:(a=s,0===em&&ey($)),a!==s)for(;a!==s;)o.push(a),a=e.charAt(ed),b.test(a)?ed++:(a=s,0===em&&ey($));else o=s;o!==s?r=n=[n,o]:(ed=r,r=s)}else ed=r,r=s;return r!==s?(n=e.charAt(ed),v.test(n)?ed++:(n=s,0===em&&ey(D)),n===s&&(n=null),i=r=[r,n]):(ed=i,i=s),t=i!==s?e.substring(t,ed):i,em--,t===s&&(i=s,0===em&&ey(j)),t}())!==s){for((r=function(){var t,i,r;for(em++,t=ed,i=[],r=e.charAt(ed),_.test(r)?ed++:(r=s,0===em&&ey(W));r!==s;)i.push(r),i.length>=2?r=s:(r=e.charAt(ed),_.test(r)?ed++:(r=s,0===em&&ey(W)));return i.length<1?(ed=t,t=s):t=i,em--,t===s&&(i=s,0===em&&ey(B)),t}())===s&&(r=null),n=[],o=eM();o!==s;)n.push(o),o=eM();for(o=eT(),(a=eA())===s&&(a=null),l=[],h=eP();h!==s;)l.push(h),h=eP();t=eu(i,r,n,a,l)}else ed=t,t=s;return t}function eM(){var t,i,r,n,o;if(em++,t=ed,eT(),36===e.charCodeAt(ed)?(i="$",ed++):(i=s,0===em&&ey(z)),i!==s){if(r=ed,n=[],o=e.charAt(ed),g.test(o)?ed++:(o=s,0===em&&ey(R)),o!==s)for(;o!==s;)n.push(o),o=e.charAt(ed),g.test(o)?ed++:(o=s,0===em&&ey(R));else n=s;(r=n!==s?e.substring(r,ed):n)!==s?t=r:(ed=t,t=s)}else ed=t,t=s;return em--,t===s&&0===em&&ey(U),t}function eA(){var t;return(t=function(){var t,i,r,n,o;if(em++,t=ed,123===e.charCodeAt(ed)?(i="{",ed++):(i=s,0===em&&ey(H)),i!==s){for(r=ed,n=[],o=e.charAt(ed),w.test(o)?ed++:(o=s,0===em&&ey(Q));o!==s;)n.push(o),o=e.charAt(ed),w.test(o)?ed++:(o=s,0===em&&ey(Q));(r=e.substring(r,ed),125===e.charCodeAt(ed)?(n="}",ed++):(n=s,0===em&&ey(V)),n!==s)?t=r.replace(/[\r\n]+/g," "):(ed=t,t=s)}else ed=t,t=s;return em--,t===s&&(i=s,0===em&&ey(G)),t}())===s&&(t=function(){var t,i,r,n,o;if(em++,t=ed,59===e.charCodeAt(ed)?(i=";",ed++):(i=s,0===em&&ey(X)),i!==s){for(r=ed,n=[],o=e.charAt(ed),k.test(o)?ed++:(o=s,0===em&&ey(Y));o!==s;)n.push(o),o=e.charAt(ed),k.test(o)?ed++:(o=s,0===em&&ey(Y));t=(r=e.substring(r,ed)).trim()}else ed=t,t=s;return em--,t===s&&(i=s,0===em&&ey(Z)),t}()),t}function eP(){var t,i,r,n;return(em++,t=ed,eT(),40===e.charCodeAt(ed)?(i="(",ed++):(i=s,0===em&&ey(ee)),i!==s&&(r=ex())!==s&&(eT(),41===e.charCodeAt(ed)?(n=")",ed++):(n=s,0===em&&ey(et)),n!==s))?t=r:(ed=t,t=s),em--,t===s&&0===em&&ey(J),t}function eT(){var t,i;for(em++,t=[],i=e.charAt(ed),y.test(i)?ed++:(i=s,0===em&&ey(el));i!==s;)t.push(i),i=e.charAt(ed),y.test(i)?ed++:(i=s,0===em&&ey(el));return em--,i=s,0===em&&ey(ea),t}if(o=h(),t.peg$library)return{peg$result:o,peg$currPos:ed,peg$FAILED:s,peg$maxFailExpected:eg,peg$maxFailPos:ep};if(o!==s&&ed===e.length)return o;throw o!==s&&ed<e.length&&ey({type:"end"}),i=eg,r=ep<e.length?e.charAt(ep):null,n=ep<e.length?ek(ep,ep+1):ek(ep,ep),new e3(e3.buildMessage(i,r),i,r,n)}(e);this.reset();let n=r.headers,o="";for(let e in n)"fen"===e.toLowerCase()&&(o=n[e]),this.header(e,n[e]);if(t){if("1"===n.SetUp){if(!("FEN"in n))throw Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(n.FEN,{preserveHeaders:!0})}}else o&&this.load(o,{preserveHeaders:!0});let s=r.root;for(;s;){if(s.move){let e=this._moveFromSan(s.move,t);if(null==e)throw Error(`Invalid move in PGN: ${s.move}`);this._makeMove(e),this._incPositionCount()}void 0!==s.comment&&(this._comments[this.fen()]=s.comment),s=s.variations[0]}let a=r.result;a&&Object.keys(this._header).length&&this._header.Result!==a&&this.setHeader("Result",a)}_moveToSan(e,t){let i="";if(e.flags&ts.KSIDE_CASTLE)i="O-O";else if(e.flags&ts.QSIDE_CASTLE)i="O-O-O";else{if(e.flags&ts.NULL_MOVE)return"--";if("p"!==e.piece){let r=function(e,t){let i=e.from,r=e.to,n=e.piece,o=0,s=0,a=0;for(let e=0,l=t.length;e<l;e++){let l=t[e].from,h=t[e].to;n===t[e].piece&&i!==l&&r===h&&(o++,i>>4==l>>4&&s++,(15&i)==(15&l)&&a++)}if(o>0)if(s>0&&a>0)return tw(i);else if(a>0)return tw(i).charAt(1);else return tw(i).charAt(0);return""}(e,t);i+=e.piece.toUpperCase()+r}e.flags&(ts.CAPTURE|ts.EP_CAPTURE)&&("p"===e.piece&&(i+=tw(e.from)[0]),i+="x"),i+=tw(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,t=!1){let i,r,n,o,s,a=tS(e);if(t||("0-0"===a?a="O-O":"0-0-0"===a&&(a="O-O-O")),"--"==a)return{color:this._turn,from:0,to:0,piece:"k",flags:ts.NULL_MOVE};let l=tC(a),h=this._moves({legal:!0,piece:l});for(let e=0,t=h.length;e<t;e++)if(a===tS(this._moveToSan(h[e],h)))return h[e];if(t)return null;let c=!1;if((r=a.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/))?(i=r[1],n=r[2],o=r[3],s=r[4],1==n.length&&(c=!0)):(r=a.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))&&(i=r[1],n=r[2],o=r[3],s=r[4],1==n.length&&(c=!0)),l=tC(a),h=this._moves({legal:!0,piece:i||l}),!o)return null;for(let e=0,t=h.length;e<t;e++)if(n){if((!i||i.toLowerCase()==h[e].piece)&&th[n]==h[e].from&&th[o]==h[e].to&&(!s||s.toLowerCase()==h[e].promotion))return h[e];else if(c){let t=tw(h[e].from);if((!i||i.toLowerCase()==h[e].piece)&&th[o]==h[e].to&&(n==t[0]||n==t[1])&&(!s||s.toLowerCase()==h[e].promotion))return h[e]}}else if(a===tS(this._moveToSan(h[e],h)).replace("x",""))return h[e];return null}ascii(){let e="   +------------------------+\n";for(let t=th.a8;t<=th.h1;t++){if(0==(15&t)&&(e+=" "+"87654321"[t>>4]+" |"),this._board[t]){let i=this._board[t].type;e+=" "+("w"===this._board[t].color?i.toUpperCase():i.toLowerCase())+" "}else e+=" . ";t+1&136&&(e+="|\n",t+=8)}return e+"   +------------------------+\n     a  b  c  d  e  f  g  h"}perft(e){let t=this._moves({legal:!1}),i=0,r=this._turn;for(let n=0,o=t.length;n<o;n++)this._makeMove(t[n]),!this._isKingAttacked(r)&&(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}setTurn(e){return this._turn!=e&&(this.move("--"),!0)}turn(){return this._turn}board(){let e=[],t=[];for(let i=th.a8;i<=th.h1;i++)null==this._board[i]?t.push(null):t.push({square:tw(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(t),t=[],i+=8);return e}squareColor(e){if(e in th){let t=th[e];return((t>>4)+(15&t))%2==0?"light":"dark"}return null}history({verbose:e=!1}={}){let t=[],i=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){let r=t.pop();if(!r)break;e?i.push(new tn(this,r)):i.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return i}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){let t=this._positionCount.get(e)??0;1===t?this._positionCount.delete(e):this._positionCount.set(e,t-1)}_pruneComments(){let e=[],t={},i=e=>{e in this._comments&&(t[e]=this._comments[e])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){let t=e.pop();if(!t)break;this._makeMove(t),i(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){let e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{let t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(let i of["k","q"])void 0!==t[i]&&(t[i]?this._castling[e]|=tm[i]:this._castling[e]&=~tm[i]);this._updateCastlingRights();let i=this.getCastlingRights(e);return(void 0===t.k||t.k===i.k)&&(void 0===t.q||t.q===i.q)}getCastlingRights(e){return{k:(this._castling[e]&tm.k)!=0,q:(this._castling[e]&tm.q)!=0}}moveNumber(){return this._moveNumber}}var tE=e.i(3974),tM=e.i(13854),tA=e.i(76552),tP=e.i(69073),tT=e.i(97555),tO=e.i(37828),tR=e.i(36057),tL=e.i(69120),tI=e.i(32963),tj=e.i(23411),tN=e.i(63745),tq=e.i(66796),tK=e.i(8979),tF=e.i(83270),t$=e.i(88830),tD=e.i(18452),tB=e.i(87812),tW=e.i(70607);let tU={0:{description:"Very easy",UciEloRange:[400,800],skillLevelRange:[0,2],moveTimeRange:[200,500],depthRange:[1,1],limitStrength:!0},1:{description:"Easy",UciEloRange:[800,1200],skillLevelRange:[3,6],moveTimeRange:[500,1e3],depthRange:[2,4],limitStrength:!0},2:{description:"Medium",UciEloRange:[1200,2e3],skillLevelRange:[7,12],moveTimeRange:[1e3,2e3],depthRange:[5,9],limitStrength:!0},3:{description:"Hard",UciEloRange:null,skillLevelRange:[13,18],moveTimeRange:[2e3,6e3],depthRange:[10,19],limitStrength:!1},4:{description:"Very hard",UciEloRange:null,skillLevelRange:[19,20],moveTimeRange:[1e4,2e4],depthRange:[20,32],limitStrength:!1}},tz=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;var tG=e.i(92863),tH=e.i(45),tQ=e.i(56105),tV=e.i(12872),tZ=e.i(59722),tX=e.i(16362);class tY{constructor(){this.wasmSupported="object"==typeof WebAssembly&&WebAssembly.validate(Uint8Array.of(0,97,115,109,1,0,0,0)),this.worker=new Worker(this.wasmSupported?"/online-games-portal/js/stockfish.wasm.js":"/online-games-portal/js/stockfish.js"),this.onMessage=null,this.initialized=!1,this.uciElo=100,this.skillLevel=0,this.depth=1,this.moveTime=500,this.limitStrength=!0,this.worker.onmessage=e=>{this.onMessage&&this.onMessage(e.data)}}init(){this.sendCommand("uci"),this.sendCommand("isready"),this.initialized=!0}setDifficulty(e){let t=function(e=1){return{uciElo:tU[e].UciEloRange?tz(tU[e].UciEloRange[0],tU[e].UciEloRange[1]):null,skillLevel:tz(tU[e].skillLevelRange[0],tU[e].skillLevelRange[1]),moveTime:tz(tU[e].moveTimeRange[0],tU[e].moveTimeRange[1]),depth:tz(tU[e].depthRange[0],tU[e].depthRange[1]),limitStrength:tU[e].limitStrength}}(e);this.uciElo=t.uciElo,this.skillLevel=t.skillLevel,this.depth=t.depth,this.moveTime=t.moveTime,this.limitStrength=t.limitStrength,this.sendCommand(`setoption name Skill Level value ${this.skillLevel}`),this.sendCommand(`setoption name UCI_LimitStrength value ${this.limitStrength}`),this.uciElo&&this.sendCommand(`setoption name UCI_Elo value ${this.uciElo}`)}sendCommand(e){this.worker.postMessage(e)}setPosition(e,t=[]){let i=`position fen ${e}`;t.length>0&&(i=`position fen ${e} moves ${t.join(" ")}`),this.sendCommand(i)}getBestMove(){this.sendCommand("stop"),this.skillLevel<=3?this.sendCommand(`go depth ${this.depth}`):this.skillLevel<=8?this.sendCommand(`go depth ${this.depth} movetime ${this.moveTime}`):this.sendCommand(`go movetime ${this.moveTime}`)}stop(){this.sendCommand("stop")}destroy(){this.worker.terminate()}}function tJ(){(0,n.useRouter)();let{currentUser:e,setCurrentUser:t}=(0,o.useContext)(tF.CurrentUserContext),{socket:r}=(0,o.useContext)(t$.SocketContext),[c,p]=(0,o.useState)(75),v=e=>{"zoomOut"===e&&(100===c&&p(75),75===c&&p(50)),"zoomIn"===e&&(50===c&&p(75),75===c&&p(100))},S=(0,n.useSearchParams)().get("id"),[A,R]=(0,o.useState)(!1),[L,I]=(0,o.useState)(!0),[j,D]=(0,o.useState)(!1),[B,z]=(0,o.useState)(new tx),[H,V]=(0,o.useState)({}),[Z,ei]=(0,o.useState)(""),[ea,el]=(0,o.useState)(null),[eu,ed]=(0,o.useState)("white"),[ef,eS]=(0,o.useState)([]),[eA,eP]=(0,o.useState)(),[eT,eR]=(0,o.useState)(null),[eL,e3]=(0,o.useState)(!1),[e6,e8]=(0,o.useState)(null),[e5,e4]=(0,o.useState)(!1),[e7,e9]=o.default.useState(!1),te=(e,t)=>{"clickaway"!==t&&e9(!1)},tt=(0,o.useRef)(null),ti=(0,o.useRef)(null),tr=(0,o.useRef)(!1),tn=ea&&"white"===ea?"black":"white",to=H.players?.black==="Computer";(0,o.useEffect)(()=>{if(to&&!eT){let t=new tY;t.init(),t.onMessage=e=>{if(e.startsWith("bestmove")){let t=e.split(" ");t[1]&&"(none)"!==t[1]&&e8(t[1]),e3(!1)}},t.setDifficulty(e?.computerStrength?.chess||0),eR(t)}return()=>{eT&&eT.destroy()}},[to]),(0,o.useEffect)(()=>{eL&&!B.isGameOver()&&(!eT||!to||B.isGameOver()||ts||null===ea||(eT.setPosition(B.fen()),.2>Math.random()&&eT.setDifficulty(e?.computerStrength?.chess||0),eT.getBestMove()))},[B,eT,to,eL]),(0,o.useEffect)(()=>{r&&r.emit("list of games",{})},[]),(0,o.useEffect)(()=>{H.players&&e.login&&(H.players.white===e.login?el("white"):H.players.black===e.login&&el("black"))},[H,e]),(0,o.useEffect)(()=>{ed("w"===B.turn()?"white":"black"),to&&"b"===B.turn()&&e3(!0)},[B]);let ts=ea===eu,ta=H&&"ongoing"===H.status&&H.players&&null!==H.players.white&&null!==H.players.black,tl=(0,o.useCallback)(()=>{let e=new Map;for(let t=0;t<64;t++){let i="abcdefgh"[t%8]+(Math.floor(t/8)+1),r=B.moves({square:i,verbose:!0});r.length>0&&e.set(i,r.map(e=>e.to))}return e},[B]),th=(0,o.useCallback)(()=>{let t="",i=!1;return B.isCheckmate()?(t=`${(0,tW.default)("checkmate",e.language)}. ${"w"===B.turn()?(0,tW.default)("blackWinsGame",e.language):(0,tW.default)("whiteWinsGame",e.language)}`,i=!0):B.isStalemate()?(t=`${(0,tW.default)("stalemate",e.language)}. ${(0,tW.default)("draw",e.language)}`,i=!0):B.isInsufficientMaterial()?(t=`${(0,tW.default)("insufficientMaterial",e.language)}. ${(0,tW.default)("draw",e.language)}`,i=!0):B.isThreefoldRepetition()?(t=`${(0,tW.default)("threefoldRepetition",e.language)}. ${(0,tW.default)("draw",e.language)}`,i=!0):B.isDraw()?(t=`${(0,tW.default)("draw",e.language)} ${(0,tW.default)("by50MoveRule",e.language)}`,i=!0):t=B.isCheck()?`${"w"===B.turn()?(0,tW.default)("whiteIsInCheck",e.language):(0,tW.default)("blackIsInCheck",e.language)}!`:`${"w"===B.turn()?(0,tW.default)("whitesTurn",e.language):(0,tW.default)("blacksTurn",e.language)}`,(i||!eL)&&eT&&to&&eT.stop(),{gameOver:i,status:t,isCheck:B.isCheck(),isCheckmate:B.isCheckmate(),isDraw:B.isDraw()}},[B]),tc=(0,o.useCallback)((t,i)=>{if(!ts)return!1;try{let n=B.get(t);if(n&&("white"===ea&&"w"!==n.color||"black"===ea&&"b"!==n.color))return!1;if(n&&"p"===n.type&&("w"===n.color&&"8"===i[1]||"b"===n.color&&"1"===i[1])?B.move({from:t,to:i,promotion:"q"}):B.move({from:t,to:i})){eS([t,i]);let n=new tx;return n.loadPgn(B.pgn()),z(n),ei(n.pgn()),r.emit("update game",{name:"chess",gameId:S,login:e.login,token:e.token,move:{pgn:n.pgn()}}),!0}return!1}catch(e){return console.error("Invalid move:",e),!1}},[B,r,S,e,ts,ta,ea]);return((0,o.useEffect)(()=>{if(e6&&!ts&&null!==ea)try{let t=B.move(e6);if(t){eS([t.from,t.to]);let i=new tx;i.loadPgn(B.pgn()),z(i),ei(i.pgn()),r.emit("update game",{name:"chess",gameId:S,login:e.login,token:e.token,move:{pgn:i.pgn()}}),e3(!1),e8(null)}}catch(e){console.error("Computer move error:",e)}},[e6,eL]),(0,o.useEffect)(()=>(tt.current&&!tr.current&&(tr.current=!0,th(),ti.current=function(e,t){let i,r={pieces:en(et),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,touchIgnoreRadius:1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,additionalPremoveRequirements:e=>!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnMovablePieceClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10},paleWhite:{key:"pwhite",color:"white",opacity:.6,lineWidth:10}},prevSvgHash:""},hold:{start(){i=performance.now()},cancel(){i=void 0},stop(){if(!i)return 0;let e=performance.now()-i;return i=void 0,e}}};function n(){var t;let i,n="dom"in r?r.dom.unbind:void 0,o=function(e,t){let i,r,n,o,h,c;for(let i of(e.innerHTML="",e.classList.add("cg-wrap"),s))e.classList.toggle("orientation-"+i,t.orientation===i);e.classList.toggle("manipulable",!t.viewOnly);let u=E("cg-container");e.appendChild(u);let d=E("cg-board");if(u.appendChild(d),t.drawable.visible&&([i,r]=["cg-shapes-below","cg-shapes"].map(e=>ez(e,!0)),[n,o]=["cg-custom-below","cg-custom-svgs"].map(e=>ez(e,!1)),h=E("cg-auto-pieces"),u.appendChild(i),u.appendChild(n),u.appendChild(r),u.appendChild(o),u.appendChild(h)),t.coordinates){let e="black"===t.orientation?" black":"",i="left"===t.ranksPosition?" left":"";if(t.coordinatesOnSquares){let r="white"===t.orientation?e=>e+1:e=>8-e;a.forEach((t,n)=>u.appendChild(eG(l.map(e=>t+e),"squares rank"+r(n)+e+i,n%2==0?"black":"white")))}else u.appendChild(eG(l,"ranks"+e+i,"right"===t.ranksPosition==("white"===t.orientation)?"white":"black")),u.appendChild(eG(a,"files"+e,m(t.orientation)))}return!t.viewOnly&&t.draggable.enabled&&t.draggable.showGhost&&(y(c=E("piece","ghost"),!1),u.appendChild(c)),{board:d,container:u,wrap:e,ghost:c,shapes:r,shapesBelow:i,custom:o,customBelow:n,autoPieces:h}}(e,r),h=g(()=>o.board.getBoundingClientRect()),c=e=>{var t;!function(e){let t,i,r,n,o,s,a,l,h,c="white"===e.orientation,u=_(e.dom.bounds()),f=e.dom.elements.board,p=e.pieces,g=e.animation.current,m=g?g.plan.anims:new Map,b=g?g.plan.fadings:new Map,v=e.draggable.current,k=new Set,C=new Map,S=function(e){let t=new Map;if(e.lastMove&&e.highlight.lastMove)for(let[i,r]of e.lastMove.entries())e1(t,1===i?e0(e,r):r,"last-move");if(e.check&&e.highlight.check&&e1(t,e.check,"check"),e.selected&&(e1(t,e.selected,"selected"),e.movable.showDests)){for(let i of e.movable.dests?.get(e.selected)??[])e1(t,i,"move-dest"+(e.pieces.has(i)?" oc":""));for(let i of e.premovable.customDests?.get(e.selected)??e.premovable.dests??[])e1(t,i,"premove-dest"+(e.pieces.has(i)?" oc":""))}let i=e.premovable.current;if(i)for(let e of i)e1(t,e,"current-premove");else e.predroppable.current&&e1(t,e.predroppable.current.key,"current-premove");let r=e.exploding;if(r)for(let e of r.keys)e1(t,e,"exploding"+r.stage);return e.highlight.custom&&e.highlight.custom.forEach((e,i)=>{e1(t,i,e)}),t}(e),x=new Map;for(i=f.firstChild;i;){if(t=i.cgKey,eZ(i))if(r=p.get(t),o=m.get(t),s=b.get(t),n=i.cgPiece,i.cgDragging&&(!v||v.orig!==t)&&(i.classList.remove("dragging"),w(i,u(d(t),c)),i.cgDragging=!1),!s&&i.cgFading&&(i.cgFading=!1,i.classList.remove("fading")),r){if(o&&i.cgAnimating&&n===eJ(r)){let e=d(t);e[0]+=o[2],e[1]+=o[3],i.classList.add("anim"),w(i,u(e,c))}else i.cgAnimating&&(i.cgAnimating=!1,i.classList.remove("anim"),w(i,u(d(t),c)),e.addPieceZIndex&&(i.style.zIndex=eY(d(t),c)));n!==eJ(r)||s&&i.cgFading?s&&n===eJ(s)?(i.classList.add("fading"),i.cgFading=!0):e2(C,n,i):k.add(t)}else e2(C,n,i);else if(eX(i)){let e=i.className;S.get(t)===e?(y(i,!0),S.delete(t)):e2(x,e,i)}i=i.nextSibling}for(let[e,t]of S){h=x.get(t)?.pop();let i=u(d(e),c);if(h)h.cgKey=e,w(h,i),y(h,!0);else{let r=E("square",t);r.cgKey=e,w(r,i),f.insertBefore(r,f.firstChild)}}for(let[e,t]of x.entries())for(let e of t)y(e,!1);for(let[t,i]of p)if(o=m.get(t),!k.has(t))if(l=(a=C.get(eJ(i)))&&a.pop()){l.cgKey=t,l.cgFading&&(l.classList.remove("fading"),l.cgFading=!1);let i=d(t);e.addPieceZIndex&&(l.style.zIndex=eY(i,c)),o&&(l.cgAnimating=!0,l.classList.add("anim"),i[0]+=o[2],i[1]+=o[3]),w(l,u(i,c))}else{let r=eJ(i),n=E("piece",r),s=d(t);n.cgPiece=r,n.cgKey=t,o&&(n.cgAnimating=!0,s[0]+=o[2],s[1]+=o[3]),w(n,u(s,c)),e.addPieceZIndex&&(n.style.zIndex=eY(s,c)),f.appendChild(n)}for(let t of C.values()){var M=e,A=t;for(let e of A)M.dom.elements.board.removeChild(e)}}(v),o.autoPieces&&(t=o.autoPieces,function(e,t,i){let r=new Map,n=[];for(let t of e)r.set(t.hash,!1);let o=t.firstElementChild,s;for(;o;)s=o.getAttribute("cgHash"),r.has(s)?r.set(s,!0):n.push(o),o=o.nextElementSibling;for(let e of n)t.removeChild(e);for(let n of e)r.get(n.hash)||t.appendChild(i(n))}(v.drawable.autoShapes.filter(e=>e.piece).map(e=>{let t;return{shape:e,hash:[(t=e).orig,t.piece?.role,t.piece?.color,t.piece?.scale].join(","),current:!1,pendingErase:!1}}),t,e=>(function(e,{shape:t,hash:i},r){let n=t.orig,o=t.piece?.role,s=t.piece?.color,a=t.piece?.scale,l=E("piece",`${o} ${s}`);return l.setAttribute("cgHash",i),l.cgKey=n,l.cgScale=a,k(l,_(r)(d(n),"white"===e.orientation),a),l})(v,e,v.dom.bounds()))),!e&&o.shapes&&function(e,t){let i=e.drawable,r=i.current,n=r&&r.mouseSq?r:void 0,o=new Map,s=e.dom.bounds(),a=i.autoShapes.filter(e=>!e.piece);for(let t of i.shapes.concat(a).concat(n?[n]:[])){if(!t.dest)continue;let i=o.get(t.dest)??new Set,r=eD(eO(d(t.orig),e.orientation),s),n=eD(eO(d(t.dest),e.orientation),s);i.add(eB(eW(r,n))),o.set(t.dest,i)}let l=[],h=n?i.shapes.findIndex(e=>ev(e,n)&&e.brush===n.brush):-1;for(let[e,t]of i.shapes.concat(a).entries()){let i=-1!==h&&h===e;l.push({shape:t,current:!1,pendingErase:i,hash:eM(t,eI(t.dest,o),!1,s,i,eN(t.dest,o))})}n&&-1===h&&l.push({shape:n,current:!0,hash:eM(n,eI(n.dest,o),!0,s,!1,eN(n.dest,o)),pendingErase:!1});let c=l.map(e=>e.hash).join(";");c!==e.drawable.prevSvgHash&&(e.drawable.prevSvgHash=c,function(e,t,i){for(let r of[i.shapes,i.shapesBelow]){let n=r.querySelector("defs"),o=t.filter(e=>r===i.shapesBelow==!!e.shape.below),s=new Map;for(let t of o.filter(e=>e.shape.dest&&e.shape.brush)){let i=eK(e.brushes[t.shape.brush],t.shape.modifiers),{key:r,color:n}=eF(t.shape);r&&n&&s.set(r,{key:r,color:n,opacity:1,lineWidth:1}),s.set(i.key,i)}let a=new Set,l=n.firstElementChild;for(;l;)a.add(l.getAttribute("cgKey")),l=l.nextElementSibling;for(let[e,t]of s.entries())a.has(e)||n.appendChild(function(e){let t=eq(ej("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(eq(ej("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}(t))}}(i,l,t),function(e,t,i){for(let[r,n]of[[t.shapes,t.custom],[t.shapesBelow,t.customBelow]]){let[o,s]=[r,n].map(e=>e.querySelector("g")),a=e.filter(e=>r===t.shapesBelow==!!e.shape.below),l=new Map;for(let e of a)l.set(e.hash,!1);for(let e of[o,s]){let t=[],i=e.firstElementChild,r;for(;i;)r=i.getAttribute("cgHash"),l.has(r)?l.set(r,!0):t.push(i),i=i.nextElementSibling;for(let i of t)e.removeChild(i)}for(let e of a.filter(e=>!l.get(e.hash)))for(let t of i(e))t.isCustom?s.appendChild(t.el):o.appendChild(t.el)}}(l,t,t=>(function(e,{shape:t,current:i,pendingErase:r,hash:n},o,s,a){var l,h,c,u,f,p,g,m,b,v,_;let w=eD(eO(d(t.orig),e.orientation),a),k=t.dest?eD(eO(d(t.dest),e.orientation),a):w,y=t.brush&&eK(o[t.brush],t.modifiers),C=s.get(t.dest),S=[];if(y){let e,d,p=eq(ej("g"),{cgHash:n});S.push({el:p}),w[0]!==k[0]||w[1]!==k[1]?p.appendChild(function(e,t,i,r,n,o,s){var a,l;let h;function c(a){let l,h,c=(o&&!n?20:10)/64,u=r[0]-i[0],d=Math.atan2(r[1]-i[1],u),f=Math.cos(d)*c,p=Math.sin(d)*c,g=eF(e);return eq(ej("line"),{stroke:a?g.color:t.color,"stroke-width":(l=t,h=n,(l.lineWidth||10)*(h?.85:1)/64*(a?1.14:1)),"stroke-linecap":"round","marker-end":`url(#arrowhead-${a?g.key:t.key})`,opacity:e.modifiers?.hilite&&!s?1:e$(t,n,s),x1:i[0],y1:i[1],x2:r[0]-f,y2:r[1]-p})}if(!e.modifiers?.hilite)return c(!1);let u=eq(ej("g"),{opacity:t.opacity}),d=eq(ej("g"),{filter:"url(#cg-filter-blur)"});return d.appendChild((a=i,l=r,h={from:[Math.floor(Math.min(a[0],l[0])),Math.floor(Math.min(a[1],l[1]))],to:[Math.ceil(Math.max(a[0],l[0])),Math.ceil(Math.max(a[1],l[1]))]},eq(ej("rect"),{x:h.from[0],y:h.from[1],width:h.to[0]-h.from[0],height:h.to[1]-h.from[1],fill:"none",stroke:"none"}))),d.appendChild(c(!0)),u.appendChild(d),u.appendChild(c(!1)),u}(t,y,w,k,i,eI(t.dest,s),r)):p.appendChild((l=o[t.brush],h=w,c=i,u=a,f=r,e=[3/64,4/64],d=(u.width+u.height)/(4*Math.max(u.width,u.height)),eq(ej("circle"),{stroke:l.color,"stroke-width":e[+!c],fill:"none",opacity:e$(l,c,f),cx:h[0],cy:h[1],r:d-e[1]/2})))}if(t.label){let e,i,r,s,a,l=t.label;l.fill??(l.fill=t.brush&&o[t.brush].color);let h=t.brush?void 0:"tr";S.push({el:(p=l,g=n,m=w,b=k,v=C,_=h,e=.4*.75**p.text.length,i=eU(m,b,v),r=.4*("tr"===_),(s=eq(ej("g"),{transform:`translate(${i[0]+r},${i[1]-r})`,cgHash:g})).appendChild(eq(ej("circle"),{r:.2,"fill-opacity":_?1:.8,"stroke-opacity":_?1:.7,"stroke-width":.03,fill:p.fill??"#666",stroke:"white"})),(a=eq(ej("text"),{"font-size":e,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**p.text.length})).innerHTML=p.text,s.appendChild(a),s),isCustom:!0})}if(t.customSvg){let e=t.customSvg.center??"orig",[i,r]="label"===e?eU(w,k,C).map(e=>e-.5):"dest"===e?k:w,o=eq(ej("g"),{transform:`translate(${i},${r})`,cgHash:n});o.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,S.push({el:o,isCustom:!0})}return S})(e,t,i.brushes,o,s)))}(v,o)},p=()=>{eV(v);let e="white"===v.orientation,t=_(v.dom.bounds()),i=v.dom.elements.board.firstChild;for(;i;)(eZ(i)&&!i.cgAnimating||eX(i))&&w(i,t(d(i.cgKey),e)),i=i.nextSibling;o.autoPieces&&function(e){let t="white"===e.orientation,i=_(e.dom.bounds()),r=e.dom.elements.autoPieces?.firstChild;for(;r;)k(r,i(d(r.cgKey),t),r.cgScale),r=r.nextSibling}(v)},v=r;return v.dom={elements:o,bounds:h,redraw:(t=c,i=!1,()=>{i||(i=!0,requestAnimationFrame(()=>{t(),i=!1}))}),redrawNow:c,unbind:n},v.drawable.prevSvgHash="",eV(v),c(!1),!function(e,t){let i,r=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",e=>e.preventDefault()),e.viewOnly)return;let n=(i=e,e=>{i.draggable.current?eC(i):i.drawable.current?eb(i):e.shiftKey||x(e)?i.drawable.enabled&&function(e,t){var i;if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?G(e):Y(e);let r=C(t),n=ee(r,"white"===e.orientation,e.dom.bounds());n&&(e.drawable.current={orig:n,pos:r,brush:ep[+!!(((i=t).shiftKey||i.ctrlKey)&&x(i))+2*!!(i.altKey||i.metaKey||i.getModifierState?.("AltGraph"))],snapToValidMove:e.drawable.defaultSnapToValidMove},function e(t){requestAnimationFrame(()=>{let i=t.drawable.current;if(i){let r=ee(i.pos,"white"===t.orientation,t.dom.bounds());r||(i.snapToValidMove=!1);let n=i.snapToValidMove?function(e,t,i,r){let n=d(e),o=f.filter(e=>{let t,i,r,o;return n[0]===e[0]&&n[1]===e[1]||(t=n[0],T(t,i=n[1],r=e[0],o=e[1])||O(t,i,r,o))||P(n[0],n[1],e[0],e[1])}),s=o.map(e=>M(u(e),i,r)).map(e=>b(t,e)),[,a]=s.reduce((e,t,i)=>e[0]<t?e:[t,i],[s[0],0]);return u(o[a])}(i.orig,i.pos,"white"===t.orientation,t.dom.bounds()):r;n!==i.mouseSq&&(i.mouseSq=n,i.dest=n!==i.orig?n:void 0,t.dom.redrawNow()),e(t)}})}(e))}(i,e):i.viewOnly||(i.dropmode.active?function(e,t){if(!e.dropmode.active)return;q(e),K(e);let i=e.dropmode.piece;if(i){e.pieces.set("a0",i);let r=C(t),n=r&&ee(r,"white"===e.orientation,e.dom.bounds());n&&W(e,"a0",n)}e.dom.redraw()}(i,e):function(e,t){let i;if(!(e.trustAllEvents||t.isTrusted)||void 0!==t.buttons&&t.buttons>1||t.touches&&t.touches.length>1)return;let r=e.dom.bounds(),n=C(t),o=ee(n,"white"===e.orientation,r);if(!o)return;let s=e.pieces.get(o),a=e.selected;if(!a&&e.drawable.enabled&&(e.drawable.eraseOnMovablePieceClick||!s||s.color!==e.turnColor)&&e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),e_(e.drawable)),!1!==t.cancelable&&(!t.touches||e.blockTouchScroll||s||a||function(e,t){let i="white"===e.orientation,r=e.dom.bounds(),n=2*Math.pow(e.touchIgnoreRadius*r.width/16,2);for(let o of e.pieces.keys())if(b(M(o,i,r),t)<=n)return!0;return!1}(e,n)))t.preventDefault();else if(t.touches)return;let l=!!e.premovable.current,h=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Q(e,e.selected,o)?eh(e=>U(e,o),e):U(e,o);let c=e.selected===o,u=ex(e,o);if(s&&u&&c&&(i=e.pieces.get(o))&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===i.color&&(e.turnColor===i.color||e.premovable.enabled))){e.draggable.current={orig:o,piece:s,origPos:n,pos:n,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:a,originTarget:t.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging");let i=e.dom.elements.ghost;i&&(i.className=`ghost ${s.color} ${s.role}`,w(i,_(r)(d(o),"white"===e.orientation)),y(i,!0)),ew(e)}else l&&q(e),h&&K(e);e.dom.redraw()}(i,e))});r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("mousedown",n,{passive:!1})}(v,p),n||(v.dom.unbind=function(e,t){let i=[];if("ResizeObserver"in window||i.push(eH(document.body,"chessground.resize",t)),!e.viewOnly){let t=eQ(e,ek,eg),r=eQ(e,ey,em);for(let e of["touchmove","mousemove"])i.push(eH(document,e,t));for(let e of["touchend","mouseup"])i.push(eH(document,e,r));let n=()=>e.dom.bounds.clear();i.push(eH(document,"scroll",n,{capture:!0,passive:!0})),i.push(eH(window,"resize",n,{passive:!0}))}return()=>i.forEach(e=>e())}(v,p)),v.events.insert&&v.events.insert(o),v}es(r,t||{});var o=n();function c(){o.orientation=m(o.orientation),o.animation.current=o.draggable.current=o.selected=void 0,n()}return{set(e){e.orientation&&e.orientation!==o.orientation&&c(),eo(o,e),(e.fen?eh:ec)(t=>es(t,e),o)},state:o,getFen:()=>{var e;return e=o.pieces,h.map(t=>a.map(i=>{let r=e.get(i+t);if(!r)return"1";{let e=er[r.role];return"white"===r.color&&(e=e.toUpperCase()),r.promoted&&(e+="~"),e}}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())},toggleOrientation:c,setPieces(e){eh(t=>(function(e,t){for(let[i,r]of t)r?e.pieces.set(i,r):e.pieces.delete(i)})(t,e),o)},selectSquare(e,t){e?eh(i=>U(i,e,t),o):o.selected&&(G(o),o.dom.redraw())},move(e,t){eh(i=>F(i,e,t),o)},newPiece(e,t){eh(i=>$(i,e,t),o)},playPremove(){if(o.premovable.current){if(eh(X,o))return!0;o.dom.redraw()}return!1},playPredrop(e){if(o.predroppable.current){let t=function(e,t){let i=e.predroppable.current,r=!1;if(!i)return!1;if(t(i)){let t={role:i.role,color:e.movable.color};$(e,t,i.key)&&(N(e.movable.events.afterNewPiece,i.role,i.key,{premove:!1,predrop:!0}),r=!0)}return K(e),r}(o,e);return o.dom.redraw(),t}return!1},cancelPremove(){ec(q,o)},cancelPredrop(){ec(K,o)},cancelMove(){ec(e=>{Y(e),eC(e)},o)},stop(){ec(e=>{J(e),eC(e)},o)},explode(e){o.exploding={stage:1,keys:e},o.dom.redraw(),setTimeout(()=>{eE(o,2),setTimeout(()=>eE(o,void 0),120)},120)},setAutoShapes(e){ec(t=>t.drawable.autoShapes=e,o)},setShapes(e){ec(t=>t.drawable.shapes=e.slice(),o)},getKeyAtDomPos:e=>ee(e,"white"===o.orientation,o.dom.bounds()),redrawAll:n,dragNewPiece(e,t,i){let r;o.pieces.set("a0",e),o.dom.redraw(),r=C(t),o.draggable.current={orig:"a0",piece:e,origPos:r,pos:r,started:!0,element:()=>ex(o,"a0"),originTarget:t.target,newPiece:!0,force:!!i,keyHasChanged:!1},ew(o)},destroy(){J(o),o.dom.unbind&&o.dom.unbind(),o.dom.destroyed=!0}}}(tt.current,{fen:B.fen(),turnColor:eu,orientation:ea||"white",movable:{color:ts||ta?ea:null,free:!1,dests:ts?tl():new Map,events:{after:tc}},draggable:{showGhost:!0,deleteOnDropOff:!0},animation:{enabled:!0,duration:300},highlight:{lastMove:!0,check:!0},premovable:{enabled:!1},drawable:{enabled:!0}})),()=>{ti.current&&(ti.current.destroy(),ti.current=null,tr.current=!1)}),[]),(0,o.useEffect)(()=>{if(!ti.current)return;let t=th();ti.current.set({fen:B.fen(),turnColor:eu,orientation:ea||"white",movable:{color:!t.gameOver&&ts&&ta?ea:null,free:!1,dests:t.gameOver||!ts?new Map:tl(),events:{after:tc}},check:t.isCheck,lastMove:ef,animation:{enabled:!0,duration:300}}),eP(t),t.gameOver&&"finished"!==H.status&&r.emit("game over",{gameId:S,login:e.login,token:e.token}),"finished"!==H.status||e5||(e4(!0),e9(!0))},[B,eu,ts,ta,ea,ef,th,tl,tc]),(0,o.useEffect)(()=>{let e=e=>{if(S in e){j&&D(!1),L&&I(!1);let t=e[S];if(H?.status==="starting"&&t?.status==="ongoing"&&(0,tX.notifyMe)("opponentFound",t.name,t.players["black"===ea?"white":"black"]),V(t),t.moves.pgn!==Z&&t.moves.pgn.length>Z.length){ei(t.moves.pgn);let e=new tx;e.loadPgn(t.moves.pgn);let i=e.history({verbose:!0});if(i.length>0){let e=i[i.length-1];eS([e.from,e.to])}z(e)}}else A?L||I(!0):j||D(!0)};return r.on("list of games",e),()=>{r.off("list of games",e)}},[r,S,Z,A]),(0,o.useEffect)(()=>{if(Z){let e=new tx;try{e.loadPgn(Z),z(e)}catch(e){console.error("Error loading PGN:",e)}}},[Z]),j)?(0,i.jsx)(tH.default,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tM.Backdrop,{sx:e=>({color:"#fff",zIndex:e.zIndex.drawer+1}),open:L,children:(0,i.jsx)(tO.CircularProgress,{disableShrink:!0,color:"inherit"})}),(0,i.jsx)(tA.Box,{sx:{width:"100%"},children:(0,i.jsx)(tD.default,{type:"game",gameId:S,gameInfo:H,handleSetIsUserLeftGame:e=>{R(!0),A!==e&&R(e)}})}),(!e.login||!ea)&&!L&&(0,i.jsx)(tA.Box,{sx:{width:"100%"},children:(0,i.jsx)(tE.Alert,{severity:"info",sx:{m:1},variant:"outlined",icon:(0,i.jsx)(tK.default,{fontSize:"inherit"}),children:(0,tW.default)("spectatorMode",e.language)})}),(0,i.jsxs)(tR.Grid,{container:!0,spacing:3,sx:{p:1,pt:0},children:[(0,i.jsx)(tR.Grid,{size:"grow",sx:{alignItems:"center",alignContent:"center"},children:(0,i.jsx)(tA.Box,{sx:{pl:1},children:(0,i.jsx)(tq.Typography,{variant:"body1",sx:{fontWeight:"bold"},noWrap:!0,children:"white"!==ea&&ea?"black"===ea?H.players?.black:"finished"===H.status?(0,i.jsx)(tT.Chip,{label:(0,tW.default)("opponentLeftTheGame",e.language),size:"small",variant:"outlined",component:"span",sx:{fontFamily:"Roboto Condensed",fontWeight:"normal"}}):H.players?.white||"":H.players?.white})})}),(0,i.jsx)(tR.Grid,{size:"auto",children:(0,i.jsxs)(tN.Stack,{direction:"row",spacing:1,alignItems:"center",children:[(0,i.jsx)(tQ.default,{sx:{transform:"rotate(180deg)"},color:("white"!==ea||"w"!==B.turn())&&("black"!==ea||"b"!==B.turn())&&(ea||"w"!==B.turn())?"disabled":"inherit"}),(0,i.jsx)(tA.Box,{sx:{display:"block",width:"32px",height:"32px",backgroundColor:"#ECDAB9",borderRadius:"50%"},children:(0,i.jsx)(tA.Box,{sx:{display:"block",width:"32px",height:"32px",background:"b"===B.turn()?'url("/online-games-portal/img/chess/chess-king-black.svg") no-repeat center center / cover':"w"===B.turn()?'url("/online-games-portal/img/chess/chess-king-white.svg") no-repeat center center / cover':"none"}})}),(0,i.jsx)(tQ.default,{color:("white"!==ea||"b"!==B.turn())&&("black"!==ea||"w"!==B.turn())&&(ea||H?.moves?.current_move!=="black")?"disabled":"inherit"})]})}),(0,i.jsx)(tR.Grid,{size:"grow",sx:{alignItems:"center",alignContent:"center"},children:(0,i.jsx)(tA.Box,{sx:{pr:1,textAlign:"right"},children:(0,i.jsxs)(tq.Typography,{variant:"body1",sx:{fontWeight:"bold"},noWrap:!0,children:["black"===ea?H.players?.white?H.players.white:"finished"===H.status?"":(0,i.jsx)(tT.Chip,{label:(0,tW.default)("waitingForOpponent",e.language),size:"small",variant:"outlined",component:"span",sx:{fontWeight:"normal",fontFamily:"Roboto Condensed"}}):H.players?.black?"Computer"===H.players.black?(0,i.jsx)(i.Fragment,{children:(0,tW.default)("computer",e.language)}):H.players.black:"finished"===H.status?"":(0,i.jsx)(tT.Chip,{label:(0,tW.default)("waitingForOpponent",e.language),size:"small",variant:"outlined",component:"span",sx:{fontWeight:"normal",fontFamily:"Roboto Condensed"}}),"finished"!==H.status&&("white"===ea&&"b"===B.turn()||"black"===ea&&"w"===B.turn())?"":"finished"===H.status?("white"!==ea||H.players.black)&&("black"!==ea||H.players.white)&&(ea||H.players.black)?"":(0,i.jsx)(tT.Chip,{label:(0,tW.default)("opponentLeftTheGame",e.language),size:"small",variant:"outlined",component:"span",sx:{fontFamily:"Roboto Condensed",fontWeight:"normal"}}):""]})})})]}),(0,i.jsx)(tA.Box,{sx:{p:2,pt:0,pb:1,textAlign:"center",width:"100%",justifyContent:"center"},children:(0,i.jsxs)(tN.Stack,{direction:"row",spacing:2,justifyContent:"space-between",children:[(0,i.jsx)(tA.Box,{sx:{alignItems:"center",alignContent:"center"},children:(0,i.jsxs)(tq.Typography,{variant:"body2",sx:{color:"#8d8d8e",fontFamily:"Roboto Condensed"},noWrap:!0,children:[ea&&H?.status!=="finished"&&("white"===ea&&"w"===B.turn()||"black"===ea&&"b"===B.turn())?(0,i.jsx)(i.Fragment,{children:(0,tW.default)("yourTurn",e.language)}):"",ea&&H?.status==="finished"&&H?.result.toLowerCase().startsWith(ea?.toLowerCase())?(0,i.jsx)(i.Fragment,{children:(0,tW.default)("youWin",e.language)}):H?.result?.toLowerCase().startsWith("draw")?(0,i.jsx)(i.Fragment,{children:(0,tW.default)("draw",e.language)}):"",ea&&"finished"!==H.status&&("white"===ea&&"b"===B.turn()||"black"===ea&&"w"===B.turn())?(0,i.jsx)(i.Fragment,{children:(0,tW.default)("waitingForOpponent",e.language)}):("finished"===H.status&&("white"!==ea||H.players.black)&&("black"!==ea||H.players.white),""),ea&&H?.status==="finished"&&H?.result.toLowerCase().startsWith(tn?.toLowerCase()||"draw")?(0,i.jsx)(i.Fragment,{children:(0,tW.default)("opponentWins",e.language)}):""]})}),(0,i.jsx)(tA.Box,{children:(0,i.jsxs)(tP.ButtonGroup,{variant:"outlined","aria-label":"Basic button group",size:"small",children:[(0,i.jsx)(tL.IconButton,{disabled:50===c,onClick:e=>v("zoomOut"),children:(0,i.jsx)(tV.default,{})}),(0,i.jsx)(tL.IconButton,{disabled:100===c,onClick:e=>v("zoomIn"),children:(0,i.jsx)(tZ.default,{})})]})})]})}),(0,i.jsx)(tA.Box,{sx:{flexGrow:1,display:"flex",justifyContent:"center",m:"5px 0"},children:(0,i.jsx)("div",{className:`chess-board-container ${c<100?" chess-board-container__"+c:""}`,children:(0,i.jsx)("div",{ref:tt})})}),(0,i.jsx)(tA.Box,{sx:{width:"100%",p:2},children:(0,i.jsx)(tI.Paper,{sx:{width:"100%",overflow:"hidden",p:1,textAlign:"center"},children:eA&&!eA.gameOver&&"finished"!==H.status?eA.status:eA?.gameOver?(H.status,eA.status):"finished"===H.status?H.players.black?`${(0,tW.default)("whiteLeftTheGame",e.language)}`:`${(0,tW.default)("blackLeftTheGame",e.language)}`:eA?.status})}),(0,i.jsx)(tA.Box,{sx:{width:"100%",p:2},children:(0,i.jsx)(tB.default,{pgn:Z,fen:B.fen()})}),(0,i.jsx)(tj.Snackbar,{open:e7,autoHideDuration:6e3,onClose:te,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,i.jsx)(tE.Alert,{onClose:te,severity:"info",variant:"filled",sx:{width:"100%"},children:H?.result?.startsWith("black")?(0,i.jsx)(i.Fragment,{children:(0,tW.default)("blackWinsGame",e.language)}):H?.result?.startsWith("white")?(0,i.jsx)(i.Fragment,{children:(0,tW.default)("whiteWinsGame",e.language)}):H?.result?.startsWith("draw")?(0,i.jsx)(i.Fragment,{children:(0,tW.default)("draw",e.language)}):eA?.status})})]})}e.s(["default",0,function(e){let t,n,s=(0,r.c)(3),{children:a}=e;return s[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,i.jsx)(tG.default,{}),s[0]=t):t=s[0],s[1]!==a?(n=(0,i.jsx)(o.Suspense,{fallback:t,children:(0,i.jsx)(tJ,{children:a})}),s[1]=a,s[2]=n):n=s[2],n}],55054)}]);